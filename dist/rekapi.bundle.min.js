/*jslint browser: true, nomen: true, plusplus: true, undef: true, vars: true, white: true */
/**
 * Rekapi - Rewritten Kapi. v0.9.7 (Sun, 17 Jun 2012 23:03:18 GMT)
 * https://github.com/jeremyckahn/rekapi
 *
 * By Jeremy Kahn (jeremyckahn@gmail.com), with significant contributions from
 *   Franck Lecollinet
 *
 * Make fun keyframe animations with JavaScript.
 * Dependencies: Underscore.js (https://github.com/documentcloud/underscore),
 *   Shifty.js (https://github.com/jeremyckahn/shifty).
 * MIT Lincense.  This code free to use, modify, distribute and enjoy.
 */
/*!
 Lo-Dash 0.3.1 lodash.com/license
 Underscore.js 1.3.3 github.com/documentcloud/underscore/blob/master/LICENSE
*/
;(function(e,t){"use strict";function s(e){return"[object Arguments]"==nt.call(e)}function o(e){return new u(e)}function u(e){if(e&&e._wrapped)return e;this._wrapped=e}function a(){for(var e,t,s,o=-1,u=arguments.length,a={e:"",f:"",k:"",q:"",c:{d:"",m:"++l<o"},o:{d:""}};++o<u;)for(t in e=arguments[o],e)s=(s=e[t])==r?"":s,/d|m|j/.test(t)?("string"==typeof s&&(s={b:s,n:s}),a.c[t]=s.b,a.o[t]=s.n):a[t]=s;e=a.a,t=a.c,s=a.o;var o=/^[^,]+/.exec(e)[0],u=s.m,f=/\S+$/.exec(u||o)[0];a.g=o,a.i=O,a.h="j.call("+
f+",l)",a.l=f,a.p=j,a.r=a.r!==i,a.f||(a.f="if(!"+o+")return u");if("r"==o||!t.j)a.c=r;return u||(s.m="l in "+f),Function("c,i,j,k,n,s,w,z,C,D,h,E",'"use strict";return function('+e+"){"+ft(a)+"}")(z,V,Z,k,h,R,tt,K,nt,n,i)}function f(e,t){return I[t]}function l(e){return"\\"+U[e]}function c(e){return q[e]}function h(e,t){return function(n,r,i){return e.call(t,n,r,i)}}function p(){}function d(e,t){var n=I.length;return I[n]="'+_.escape("+t+")+'",F+n}function v(e,t){var n=I.length;return I[n]="'+((__t=("+
t+"))==null?'':__t)+'",F+n}function m(e,t){var n=I.length;return I[n]="';"+t+";__p+='",F+n}function g(e,t,n,r){if(!e)return n;var i=e.length,s=3>arguments.length;r&&(t=h(t,r));if(i===i>>>0){for(i&&s&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}var o=Lt(e);for((i=o.length)&&s&&(n=e[o[--i]]);i--;)s=o[i],n=t(n,e[s],s,e);return n}function y(e,n,r){if(e)return n==t||r?e[0]:tt.call(e,0,n)}function b(e,t){var n=[];if(!e)return n;for(var r,i=-1,s=e.length;++i<s;)r=e[i],kt(r)?et.apply(n,t?r:b(r)):n.push(r);return n
}function w(e,t,n){if(!e)return-1;var r=-1,i=e.length;if(n){if("number"!=typeof n)return r=x(e,t),e[r]===t?r:-1;r=(0>n?Math.max(0,i+n):n)-1}for(;++r<i;)if(e[r]===t)return r;return-1}function E(e,t,n){var r=-Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]>i&&(i=e[s]);return i}for(n&&(t=h(t,n));++s<o;)n=t(e[s],s,e),n>r&&(r=n,i=e[s]);return i}function S(e,n,r){return e?tt.call(e,n==t||r?1:n):[]}function x(e,t,n,r){if(!e)return 0;var i,s=0,o=e.length;if(n){if(r)var u=n,n=function(
e){return u.call(r,e)};for(t=n(t);s<o;)i=s+o>>>1,n(e[i])<t?s=i+1:o=i}else for(;s<o;)i=s+o>>>1,e[i]<t?s=i+1:o=i;return s}function T(e,t,n,r){var s=[];if(!e)return s;var o=-1,u=e.length,a=[];"function"==typeof t&&(r=n,n=t,t=i);for(n?r&&(n=h(n,r)):n=k;++o<u;)if(r=n(e[o],o,e),t?!o||a[a.length-1]!==r:0>w(a,r))a.push(r),s.push(e[o]);return s}function N(e,t){function n(){var u=arguments,a=t;return s||(e=t[i]),o.length&&(u=u.length?Y.apply(o,u):o),this instanceof n?(p.prototype=e.prototype,a=new p,u=e.apply
(a,u),R[typeof u]&&u!==r?u:a):e.apply(a,u)}var i,s=nt.call(e)==V;if(s){if(rt)return rt.call.apply(rt,arguments)}else i=t,t=e;var o=tt.call(arguments,2);return n}function C(e,r,s){s||(s=[]);if(e===r)return 0!==e||1/e==1/r;if(e==t||r==t)return e===r;e._chain&&(e=e._wrapped),r._chain&&(r=r._wrapped);if(e.isEqual&&nt.call(e.isEqual)==V)return e.isEqual(r);if(r.isEqual&&nt.call(r.isEqual)==V)return r.isEqual(e);var o=nt.call(e);if(o!=nt.call(r))return i;switch(o){case K:return e==""+r;case $:return e!=+
e?r!=+r:0==e?1/e==1/r:e==+r;case W:case X:return+e==+r;case J:return e.source==r.source&&e.global==r.global&&e.multiline==r.multiline&&e.ignoreCase==r.ignoreCase}if("object"!=typeof e||"object"!=typeof r)return i;for(var u=s.length;u--;)if(s[u]==e)return n;var u=-1,a=n,f=0;s.push(e);if(o==z){if(f=e.length,a=f==r.length)for(;f--&&(a=C(e[f],r[f],s)););}else{if("constructor"in e!="constructor"in r||e.constructor!=r.constructor)return i;for(var l in e)if(Z.call(e,l)&&(f++,!(a=Z.call(r,l)&&C(e[l],r[l]
,s))))break;if(a){for(l in r)if(Z.call(r,l)&&!(f--))break;a=!f}if(a&&O)for(;7>++u&&(l=j[u],!Z.call(e,l)||!!(a=Z.call(r,l)&&C(e[l],r[l],s))););}return s.pop(),a}function k(e){return e}function L(e){wt(Ct(e),function(t){var r=o[t]=e[t];u.prototype[t]=function(){var e=[this._wrapped];return arguments.length&&et.apply(e,arguments),e=r.apply(o,e),this._chain&&(e=new u(e),e._chain=n),e}})}var n=!0,r=null,i=!1,A="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&
(e=global),exports),O=!{valueOf:0}.propertyIsEnumerable("valueOf"),M=0,_=e._,D=RegExp("^"+({}.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),P=/__token__(\d+)/g,H=/[&<"']/g,B=/['\n\r\t\u2028\u2029\\]/g,j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),F="__token__",I=[],q={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#x27;"},R={"boolean":i,"function":n,object:n,number:i,string:i,"undefined":i
},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},z="[object Array]",W="[object Boolean]",X="[object Date]",V="[object Function]",$="[object Number]",J="[object RegExp]",K="[object String]",Q=Array.prototype,G=Object.prototype,Y=Q.concat,Z=G.hasOwnProperty,et=Q.push,tt=Q.slice,nt=G.toString,rt=D.test(rt=tt.bind)&&/\n|Opera/.test(rt+nt.call(e.opera))&&rt,it=D.test(it=Array.isArray)&&it,st=e.isFinite,ot=D.test(ot=Object.keys)&&ot,ut=e.clearTimeout,at=e.setTimeout;o
.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:"obj"};var ft=Function("obj","var __p;with(obj){__p='var l,u';if(k){__p+='='+k};__p+=';'+f+';'+q+';';if(c){__p+='var o='+g+'.length;l=-1;';if(o){__p+='if(o===o>>>0){'};__p+=''+c['d']+';while('+c['m']+'){'+c['j']+'}';if(o){__p+='}'}}if(o){if(c){__p+='else{'}if(!i){__p+='var v=typeof '+l+'==\\'function\\';'};__p+=''+o['d']+';for('+o['m']+'){';if(i){if(r){__p+='if('+h+'){'};__p+=''+o['j']+';';if(r){__p+='}'}}else{__p+='if(!(v&&l==\\'prototype\\')';if(r){__p+='&&'+h};__p+='){'+o['j']+'}'};__p+='}';if(i){__p+='var g='+l+'.constructor;';for(var k=0;k<7;k++){__p+='l=\\''+p[k]+'\\';if(';if(p[k]=='constructor'){__p+='!(g&&g.prototype==='+l+')&&'};__p+=''+h+'){'+o['j']+'}'}}if(c){__p+='}'}};__p+=''+e+';return u'}return __p"
),lt={a:"f,d,B",k:"f",q:"if(!d){d=k}else if(B){d=n(d,B)}",j:"d(f[l],l,f)"},ct={k:"D",j:"if(!d(f[l],l,f))return!u"},ht={a:"r",k:"r",q:"for(var x,y=1,o=arguments.length;y<o;y++){x=arguments[y];"+(O?"if(x){":""),m:"l in x",r:i,j:"r[l]=x[l]",e:(O?"}":"")+"}"},pt={k:"[]",j:"d(f[l],l,f)&&u.push(f[l])"},dt={q:"if(B)d=n(d,B)"},vt={j:{n:lt.j}},mt={k:"",f:"if(!f)return[]",d:{b:"u=Array(o)",n:"u=[]"},j:{b:"u[l]=d(f[l],l,f)",n:"u.push(d(f[l],l,f))"}},gt=a({a:"r",f:"if(!s[typeof r]||r===null)throw TypeError()"
,k:"[]",j:"u.push(l)"}),D=a({a:"f,A",k:"h",j:"if(f[l]===A)return D"}),yt=a(lt,ct),G=a(lt,pt),bt=a(lt,dt,{k:"",j:"if(d(f[l],l,f))return f[l]"}),wt=a(lt,dt),Et=a(mt,{a:"f,p",q:"var b=w.call(arguments,2),m=typeof p=='function'",j:{b:"u[l]=(m?p:f[l][p]).apply(f[l],b)",n:"u.push((m?p:f[l][p]).apply(f[l],b))"}}),St=a(lt,mt),xt=a(mt,{a:"f,t",j:{b:"u[l]=f[l][t]",n:"u.push(f[l][t])"}}),mt=a({a:"f,d,a,B",k:"a",q:"var q=arguments.length<3;if(B)d=n(d,B)",d:{b:"if(q)u=f[++l]"},j:{b:"u=d(u,f[l],l,f)",n:"u=q?(q=h,f[l]):d(u,f[l],l,f)"
}}),pt=a(lt,pt,{j:"!"+pt.j}),ct=a(lt,ct,{k:"h",j:ct.j.replace("!","")}),Tt=a(ht,{j:"if(r[l]==E)"+ht.j}),Nt=a(ht),ht=a(lt,dt,vt,{r:i}),lt=a(lt,dt,vt),Ct=a({a:"r",k:"[]",r:i,j:"if(C.call(r[l])==i)u.push(l)",e:"u.sort()"});s(arguments)||(s=function(e){return!!e&&!!Z.call(e,"callee")});var kt=it||function(e){return nt.call(e)==z},it=a({a:"F",k:"D",q:"var e=C.call(F);if(e==c||e==z)return!F.length",j:{n:"return h"}}),Lt=ot?function(e){return"function"==typeof e?gt(e):ot(e)}:gt,At=a({a:"r",k:"[]",j:"u.push(r[l])"
});o.VERSION="0.3.1",o.after=function(e,t){return 1>e?t():function(){if(1>--e)return t.apply(this,arguments)}},o.bind=N,o.bindAll=function(e){var t=arguments,n=1;1==t.length&&(n=0,t=Ct(e));for(var r=t.length;n<r;n++)e[t[n]]=N(e[t[n]],e);return e},o.chain=function(e){return e=new u(e),e._chain=n,e},o.clone=function(e){return R[typeof e]&&e!==r?kt(e)?e.slice():Nt({},e):e},o.compact=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length;++n<r;)e[n]&&t.push(e[n]);return t},o.compose=function(){var e=
arguments;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},o.contains=D,o.debounce=function(e,n,r){function i(){a=t,r||e.apply(u,s)}var s,o,u,a;return function(){var t=r&&!a;return s=arguments,u=this,ut(a),a=at(i,n),t&&(o=e.apply(u,s)),o}},o.defaults=Tt,o.defer=function(e){var n=tt.call(arguments,1);return at(function(){return e.apply(t,n)},1)},o.delay=function(e,n){var r=tt.call(arguments,2);return at(function(){return e.apply(t,r)},n)},o.difference=function(
e){var t=[];if(!e)return t;for(var n=-1,r=e.length,i=Y.apply(t,tt.call(arguments,1));++n<r;)0>w(i,e[n])&&t.push(e[n]);return t},o.escape=function(e){return e==r?"":(e+"").replace(H,c)},o.every=yt,o.extend=Nt,o.filter=G,o.find=bt,o.first=y,o.flatten=b,o.forEach=wt,o.forIn=ht,o.forOwn=lt,o.functions=Ct,o.groupBy=function(e,t,n){var r={};if(!e)return r;var i,s=-1,o="function"==typeof t,u=e.length;for(o&&n&&(t=h(t,n));++s<u;)i=e[s],n=o?t(i,s,e):i[t],(Z.call(r,n)?r[n]:r[n]=[]).push(i);return r},o.has=
function(e,t){return Z.call(e,t)},o.identity=k,o.indexOf=w,o.initial=function(e,n,r){return e?tt.call(e,0,-(n==t||r?1:n)):[]},o.intersection=function(e){var t=[];if(!e)return t;for(var n,r=-1,i=e.length,s=tt.call(arguments,1);++r<i;)n=e[r],0>w(t,n)&&yt(s,function(e){return-1<w(e,n)})&&t.push(n);return t},o.invoke=Et,o.isArguments=s,o.isArray=kt,o.isBoolean=function(e){return e===n||e===i||nt.call(e)==W},o.isDate=function(e){return nt.call(e)==X},o.isElement=function(e){return!!e&&1==e.nodeType},o
.isEmpty=it,o.isEqual=C,o.isFinite=function(e){return st(e)&&nt.call(e)==$},o.isFunction=function(e){return nt.call(e)==V},o.isNaN=function(e){return nt.call(e)==$&&e!=+e},o.isNull=function(e){return e===r},o.isNumber=function(e){return nt.call(e)==$},o.isObject=function(e){return R[typeof e]&&e!==r},o.isRegExp=function(e){return nt.call(e)==J},o.isString=function(e){return nt.call(e)==K},o.isUndefined=function(e){return e===t},o.keys=Lt,o.last=function(e,n,r){if(e){var i=e.length;return n==t||r?
e[i-1]:tt.call(e,-n||i)}},o.lastIndexOf=function(e,t,n){if(!e)return-1;var r=e.length;for(n&&"number"==typeof n&&(r=(0>n?Math.max(0,r+n):Math.min(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},o.map=St,o.max=E,o.memoize=function(e,t){var n={};return function(){var r=t?t.apply(this,arguments):arguments[0];return Z.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}},o.min=function(e,t,n){var r=Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]<i&&(i=e[s]);return i}for(n&&(t=h(t,n));++
s<o;)n=t(e[s],s,e),n<r&&(r=n,i=e[s]);return i},o.mixin=L,o.noConflict=function(){return e._=_,this},o.once=function(e){var t,r=i;return function(){return r?t:(r=n,t=e.apply(this,arguments))}},o.partial=function(e){var t=tt.call(arguments,1),n=t.length;return function(){var r;return r=arguments,r.length&&(t.length=n,et.apply(t,r)),r=1==t.length?e.call(this,t[0]):e.apply(this,t),t.length=n,r}},o.pick=function(e){for(var t,n=0,r=Y.apply(Q,arguments),i=r.length,s={};++n<i;)t=r[n],t in e&&(s[t]=e[t]);
return s},o.pluck=xt,o.range=function(e,t,n){n||(n=1),2>arguments.length&&(t=e||0,e=0);for(var r=-1,i=Math.max(Math.ceil((t-e)/n),0),s=Array(i);++r<i;)s[r]=e,e+=n;return s},o.reduce=mt,o.reduceRight=g,o.reject=pt,o.rest=S,o.result=function(e,t){if(!e)return r;var n=e[t];return nt.call(n)==V?e[t]():n},o.shuffle=function(e){if(!e)return[];for(var t,n=-1,r=e.length,i=Array(r);++n<r;)t=Math.floor(Math.random()*(n+1)),i[n]=i[t],i[t]=e[n];return i},o.size=function(e){var t=nt.call(e);return t==z||t==K?
e.length:Lt(e).length},o.some=ct,o.sortBy=function(e,n,r){if(!e)return[];if("string"==typeof n)var i=n,n=function(e){return e[i]};else r&&(n=h(n,r));for(var r=-1,s=e.length,o=Array(s);++r<s;)o[r]={a:n(e[r],r,e),b:e[r]};for(o.sort(function(e,n){var r=e.a,i=n.a;return r===t?1:i===t?-1:r<i?-1:r>i?1:0});s--;)o[s]=o[s].b;return o},o.sortedIndex=x,o.tap=function(e,t){return t(e),e},o.template=function(e,t,n){n||(n={});var i;i=o.templateSettings;var s=n.escape,u=n.evaluate,a=n.interpolate,n=n.variable;return s==
r&&(s=i.escape),u==r&&(u=i.evaluate),a==r&&(a=i.interpolate),s&&(e=e.replace(s,d)),a&&(e=e.replace(a,v)),u&&(e=e.replace(u,m)),e="__p='"+e.replace(B,l).replace(P,f)+"';",I.length=0,n||(n=i.variable,e="with("+n+"||{}){"+e+"}"),e="function("+n+"){var __p,__t,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"+e+"return __p}",i=Function("_","return "+e)(o),t?i(t):(i.source=e,i)},o.throttle=function(e,n){function r(){a=new Date,u=t,e.apply(o,i)}var i,s,o,u,a=0;return function(){var t=new 
Date,f=n-(t-a);return i=arguments,o=this,0>=f?(a=t,s=e.apply(o,i)):u||(u=at(r,f)),s}},o.times=function(e,t,n){var r=-1;if(n)for(;++r<e;)t.call(n,r);else for(;++r<e;)t(r)},o.toArray=function(e){if(!e)return[];if(nt.call(e.toArray)==V)return e.toArray();var t=e.length;return t===t>>>0?tt.call(e):At(e)},o.union=function(){for(var e=-1,t=[],n=Y.apply(t,arguments),r=n.length;++e<r;)0>w(t,n[e])&&t.push(n[e]);return t},o.uniq=T,o.uniqueId=function(e){var t=M++;return e?e+t:t},o.values=At,o.without=function(
e){var t=[];if(!e)return t;for(var n=tt.call(arguments,1),r=-1,i=e.length;++r<i;)0>w(n,e[r])&&t.push(e[r]);return t},o.wrap=function(e,t){return function(){var n=[e];return arguments.length&&et.apply(n,arguments),t.apply(this,n)}},o.zip=function(e){if(!e)return[];for(var t=-1,n=E(xt(arguments,"length")),r=Array(n);++t<n;)r[t]=xt(arguments,t);return r},o.all=yt,o.any=ct,o.collect=St,o.detect=bt,o.each=wt,o.foldl=mt,o.foldr=g,o.head=y,o.include=D,o.inject=mt,o.methods=Ct,o.select=G,o.tail=S,o.take=
y,o.unique=T,u.prototype=o.prototype,L(o),u.prototype.chain=function(){return this._chain=n,this},u.prototype.value=function(){return this._wrapped},wt("pop push reverse shift sort splice unshift".split(" "),function(e){var t=Q[e];u.prototype[e]=function(){var e=this._wrapped;return t.apply(e,arguments),e.length===0&&delete e[0],this._chain&&(e=new u(e),e._chain=n),e}}),wt(["concat","join","slice"],function(e){var t=Q[e];u.prototype[e]=function(){var e=t.apply(this._wrapped,arguments);return this
._chain&&(e=new u(e),e._chain=n),e}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=o,define(function(){return o})):A?"object"==typeof module&&module&&module.s==A?(module.s=o)._=o:A._=o:e._=o})(this);;/** @license
 * Shifty <http://jeremyckahn.github.com/shifty/>
 * Description: A teeny tiny tweening engine in JavaScript. That's all it does.
 * Author: Jeremy Kahn - jeremyckahn@gmail.com
 * License: MIT
 * Version: 0.6.7 (Wed, 06 Jun 2012 03:45:31 GMT)
 */
(function(){var a;(function(b){function f(a,b){var c;for(c in a)a.hasOwnProperty(c)&&b(a,c)}function g(a,b){return f(b,function(b,c){a[c]=b[c]}),a}function h(a,b){return f(b,function(b,c){typeof a[c]=="undefined"&&(a[c]=b[c])}),a}function i(a,b,c){var d,f;f=(a-b.timestamp)/b.duration;for(d in c.current)c.current.hasOwnProperty(d)&&b.to.hasOwnProperty(d)&&(c.current[d]=j(b.originalState[d],b.to[d],e[b.easing[d]],f));return c.current}function j(a,b,c,d){return a+(b-a)*c(d)}function k(a,b){return setTimeout(a,1e3/b)}function l(a,b,c,d){var e;for(e=0;e<b[a].length;e++)b[a][e].apply(c,d)}function m(b,c,d){f(a.prototype.filter,function(a,e){a[e][b]&&a[e][b].apply(c,d)})}function n(a,b){var d=a.timestamp+a.duration,e=Math.min(c(),d),f=e>=d;b.isTweening&&(f||(b.loopId=k(function(){n(a,b)},a.owner.fps)),m("beforeTween",a.owner,[b.current,a.originalState,a.to,a.easing]),i(e,a,b),m("afterTween",a.owner,[b.current,a.originalState,a.to,a.easing]),a.hook.step&&l("step",a.hook,a.owner,[b.current]),a.step&&a.step.call(b.current,b.current)),(f||!b.isTweening)&&a.owner.stop(!0)}function o(a,b){var c;return c={},typeof b=="string"?f(a,function(a,d){c[d]=b}):f(a,function(a,e){c[e]||(c[e]=b[e]||d)}),c}var c,d="linear",e;typeof SHIFTY_DEBUG_NOW=="function"?c=SHIFTY_DEBUG_NOW:c=function(){return+(new Date)},typeof SHIFTY_DEBUG_NOW=="function"&&(b.timeoutHandler=n),a=function(a){return a=a||{},this._hook={},this._tweenParams={owner:this,hook:this._hook,data:{}},this._state={},this._state.current=a.initialState||{},this.fps=a.fps||30,this.easing=a.easing||d,this.duration=a.duration||500,this},a.prototype.tween=function(a,b,d,e,f){var i,j,k;if(this._state.isTweening)return;return i=this,j=this._tweenParams,k=this._state,this._state.loopId=0,this._state.pausedAtTime=null,b?(j.to=b||{},j.duration=d||this.duration,j.callback=e,j.easing=f||this.easing,k.current=a||{}):(j.step=a.step,j.callback=a.callback,j.to=a.to||a.target||{},j.duration=a.duration||this.duration,j.easing=a.easing||this.easing,k.current=a.from||{}),j.timestamp=c(),h(k.current,j.to),h(j.to,k.current),j.easing=o(k.current,j.easing),j.originalState=g({},k.current),m("tweenCreated",j.owner,[k.current,j.originalState,j.to,j.easing]),k.isTweening=!0,this.resume(),a.start&&a.start(),this},a.prototype.to=function(b,c,d,e){return arguments.length===1?"to"in b?(b.from=this.get(),this.tween(b)):this.tween(this.get(),b):this.tween(this.get(),b,c,d,e),this},a.prototype.get=function(){return this._state.current},a.prototype.set=function(a){return this._state.current=a||{},this},a.prototype.stop=function(a){return clearTimeout(this._state.loopId),this._state.isTweening=!1,a&&(g(this._state.current,this._tweenParams.to),m("afterTweenEnd",this,[this._state.current,this._tweenParams.originalState,this._tweenParams.to,this._tweenParams.easing]),this._tweenParams.callback&&this._tweenParams.callback.call(this._state.current,this._state.current)),this},a.prototype.pause=function(){return clearTimeout(this._state.loopId),this._state.pausedAtTime=c(),this._state.isPaused=!0,this},a.prototype.resume=function(){var a;return a=this,this._state.isPaused&&(this._tweenParams.timestamp+=c()-this._state.pausedAtTime),n(a._tweenParams,a._state),this},a.prototype.hookAdd=function(a,b){this._hook.hasOwnProperty(a)||(this._hook[a]=[]),this._hook[a].push(b)},a.prototype.hookRemove=function(a,b){var c;if(!this._hook.hasOwnProperty(a))return;if(!b){this._hook[a]=[];return}for(c=this._hook[a].length;c>=0;c++)this._hook[a][c]===b&&this._hook[a].splice(c,1)},a.prototype.filter={},a.util={now:c,each:f,tweenProps:i,tweenProp:j,applyFilter:m,simpleCopy:g,weakCopy:h,composeEasingObject:o},e=a.prototype.formula={linear:function(a){return a}},typeof exports=="object"?module.exports=a:typeof define=="function"&&define.amd?define(function(){return a}):typeof b.Tweenable=="undefined"&&(b.Tweenable=a)})(this),function(){a.util.simpleCopy(a.prototype.formula,{easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-0.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-0.5*((a-=2)*Math.pow(a,3)-2)},easeInQuint:function(a){return Math.pow(a,5)},easeOutQuint:function(a){return Math.pow(a-1,5)+1},easeInOutQuint:function(a){return(a/=.5)<1?.5*Math.pow(a,5):.5*(Math.pow(a-2,5)+2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-0.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return a==0?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return a==1?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return a==0?0:a==1?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-0.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeOutBounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},elastic:function(a){return-1*Math.pow(4,-8*a)*Math.sin((a*6-1)*2*Math.PI/2)+1},swingFromTo:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},swingFrom:function(a){var b=1.70158;return a*a*((b+1)*a-b)},swingTo:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},bounce:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},bouncePast:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?2-(7.5625*(a-=1.5/2.75)*a+.75):a<2.5/2.75?2-(7.5625*(a-=2.25/2.75)*a+.9375):2-(7.5625*(a-=2.625/2.75)*a+.984375)},easeFromTo:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-0.5*((a-=2)*Math.pow(a,3)-2)},easeFrom:function(a){return Math.pow(a,4)},easeTo:function(a){return Math.pow(a,.25)}})}(),function(){function b(b,c,d,e,f){return a.util.tweenProps(e,{originalState:b,to:d,timestamp:0,duration:1,easing:f},{current:c})}function c(b,c){var d=c;return typeof c=="string"&&(d={},a.util.each(b,function(a,b){d[b]=a[b]})),d}a.util.interpolate=function(c,d,e,f){var g,h,i;c&&c.from&&(d=c.to,e=c.position,f=c.easing,c=c.from),i=new a,i._tweenParams.easing=f||"linear",g=a.util.simpleCopy({},c);var j=a.util.composeEasingObject(c,i._tweenParams.easing);return a.util.applyFilter("tweenCreated",i,[g,c,d,j]),a.util.applyFilter("beforeTween",i,[g,c,d,j]),h=b(c,g,d,e,j),a.util.applyFilter("afterTween",i,[h,c,d,j]),h},a.prototype.interpolate=function(b,c,d){var e;return e=a.util.interpolate(this.get(),b,c,d),this.set(e),e}}(),function(a){function i(a,b){var c=a.length,d,e=[];for(d=0;d<c;d++)e.push("_"+b+"_"+d);return e}function j(a){var b=a.match(c);return b.length===1&&b.unshift(""),b.join(h)}function k(b){a.util.each(b,function(a,c){var d=a[c];typeof d=="string"&&d.match(g)&&(b[c]=l(d))})}function l(a){return p(g,a,m)}function m(a){var b=n(a);return"rgb("+b[0]+","+b[1]+","+b[2]+")"}function n(a){return a=a.replace(/#/,""),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),[o(a.substr(0,2)),o(a.substr(2,2)),o(a.substr(4,2))]}function o(a){return parseInt(a,16)}function p(a,b,c){var d=b.match(a),e=b.replace(a,h);if(d){var f=d.length,g;for(var i=0;i<f;i++)g=d.shift(),e=e.replace(h,c(g))}return e}function q(a){return p(e,a,r)}function r(a){var b=a.match(d),c=b.length,e=a.match(f)[0];for(var g=0;g<c;g++)e+=parseInt(b[g],10)+",";return e=e.slice(0,-1)+")",e}function s(b){var c={};return a.util.each(b,function(a,b){var d=a[b];if(typeof d=="string"){var e=y(d);c[b]={formatString:j(d),chunkNames:i(e,b)}}}),c}function t(b,c){a.util.each(c,function(a,d){var e=b[d],f=y(e),g=f.length;for(var h=0;h<g;h++)b[c[d].chunkNames[h]]=+f[h];delete b[d]})}function u(b,c){a.util.each(c,function(a,d){var e=b[d],f=v(b,c[d].chunkNames),g=w(f,c[d].chunkNames);e=x(c[d].formatString,g),b[d]=q(e)})}function v(a,b){var c={},d,e=b.length;for(var f=0;f<e;f++)d=b[f],c[d]=a[d],delete a[d];return c}function w(a,b){var c=[],d=b.length;for(var e=0;e<d;e++)c.push(a[b[e]]);return c}function x(a,b){var c=a,d=b.length;for(var e=0;e<d;e++)c=c.replace(h,+b[e].toFixed(4));return c}function y(a){return a.match(d)}function z(b,c){a.util.each(c,function(a,c){var d=a[c],e=d.chunkNames,f=e.length,g=b[c].split(" "),h=g[g.length-1];for(var i=0;i<f;i++)b[e[i]]=g[i]||h;delete b[c]})}function A(b,c){a.util.each(c,function(a,c){var d=a[c],e=d.chunkNames,f=e.length,g="";for(var h=0;h<f;h++)g+=" "+b[e[h]],delete b[e[h]];g=g.substr(1),b[c]=g})}var b,c=/([^-0-9\.]+)/g,d=/[0-9.-]+/g,e=new RegExp("rgb\\("+d.source+",s*"+d.source+",s*"+d.source+"\\)","g"),f=/^.*\(/,g=/#([0-9]|[a-f]){3,6}/g,h="VAL";a.prototype.filter.token={tweenCreated:function(a,b,c,d){k(a),k(b),k(c),this._tokenData=s(a)},beforeTween:function(a,b,c,d){z(d,this._tokenData),t(a,this._tokenData),t(b,this._tokenData),t(c,this._tokenData)},afterTween:function(a,b,c,d){u(a,this._tokenData),u(b,this._tokenData),u(c,this._tokenData),A(d,this._tokenData)}}}(a)})();/*jslint browser: true, nomen: true, plusplus: true, undef: true, vars: true, white: true */
/**
 * Rekapi - Rewritten Kapi. v0.9.7 (Sun, 17 Jun 2012 23:03:18 GMT)
 * https://github.com/jeremyckahn/rekapi
 *
 * By Jeremy Kahn (jeremyckahn@gmail.com), with significant contributions from
 *   Franck Lecollinet
 *
 * Make fun keyframe animations with JavaScript.
 * Dependencies: Underscore.js (https://github.com/documentcloud/underscore),
 *   Shifty.js (https://github.com/jeremyckahn/shifty).
 * MIT Lincense.  This code free to use, modify, distribute and enjoy.
 */
(function(a){function b(a,b,c,d){c.each(a._events[b],function(b){b(a,d)})}function c(){}var d=function(a,c,d){function g(a,b){var c=Math.floor(b/a._animationLength);return c}function h(a){return r()-a._loopTimestamp}function i(a,b){return b>=a._timesToIterate&&a._timesToIterate!==-1}function j(a,d){i(a,d)&&(a.stop(),b(a,"animationComplete",c))}function k(a,b,c){var d;return i(a,c)?d=a._animationLength:d=b%a._animationLength,d}function l(a,b){var c=g(a,b),d=k(a,b,c);a.update(d),j(a,c)}function m(a){l(a,h(a))}function n(a){var b=function(){n(a),m(a)};a._scheduleUpdate.call?a._loopId=a._scheduleUpdate.call(f,b,1e3/a.config.fps):a._loopId=setTimeout(b,1e3/a.config.fps)}function o(a){var b;return a!==60?b=f.setTimeout:b=f.requestAnimationFrame||f.webkitRequestAnimationFrame||f.oRequestAnimationFrame||f.msRequestAnimationFrame||f.mozCancelRequestAnimationFrame&&f.mozRequestAnimationFrame||f.setTimeout,b}function p(a){var b;return a!==60?b=f.clearTimeout:b=f.cancelAnimationFrame||f.webkitCancelAnimationFrame||f.oCancelAnimationFrame||f.msCancelAnimationFrame||f.mozCancelRequestAnimationFrame||f.clearTimeout,b}function q(a){a._cancelUpdate.call?a._cancelUpdate.call(f,a._loopId):clearTimeout(a._loopId)}"use strict";var e=Function,f=e("return this")(),r=d.util.now,s={fps:60},t={STOPPED:"stopped",PAUSED:"paused",PLAYING:"playing"},u=a.Kapi||function(b){return this.config=b||{},this.context=this.config.context||{},this._actors={},this._playState=t.STOPPED,this._events={animationComplete:[],playStateChange:[],play:[],pause:[],stop:[],beforeUpdate:[],afterUpdate:[],addActor:[],removeActor:[]},this._timesToIterate=-1,this._animationLength=0,this._loopId=null,this._loopTimestamp=null,this._pausedAtTime=null,this._lastUpdatedMillisecond=0,c.extend(this.config,b),c.defaults(this.config,s),this._scheduleUpdate=o(this.config.fps),this._cancelUpdate=p(this.config.fps),c.each(this._contextInitHook,function(a){a.call(this)},this),this};u.prototype._contextInitHook={},u.prototype._recalculateAnimationLength=function(){var a=[];return c.each(this._actors,function(b){a.push(b.getEnd())}),this._animationLength=Math.max.apply(Math,a),this},u.prototype.addActor=function(a){return c.contains(this._actors,a)||(a.context()||a.context(this.context),a.kapi=this,a.fps=this.framerate(),this._actors[a.id]=a,this._recalculateAnimationLength(),a.setup(),b(this,"addActor",c,a)),this},u.prototype.getActor=function(a){return this._actors[a]},u.prototype.getActorIds=function(){return c.pluck(this._actors,"id")},u.prototype.getAllActors=function(){return c.clone(this._actors)},u.prototype.removeActor=function(a){return delete this._actors[a.id],delete a.kapi,a.teardown(),this._recalculateAnimationLength(),b(this,"removeActor",c,a),this},u.prototype.play=function(a){return q(this),this._playState===t.PAUSED?this._loopTimestamp+=r()-this._pausedAtTime:this._loopTimestamp=r(),this._timesToIterate=a||-1,this._playState=t.PLAYING,n(this),c.each(this._actors,function(a){a._state.isPaused&&a.resume()}),b(this,"playStateChange",c),b(this,"play",c),this},u.prototype.playFrom=function(a,b){return this.play(b),this._loopTimestamp=r()-a,this},u.prototype.playFromCurrent=function(a){return this.playFrom(this._lastUpdatedMillisecond,a)},u.prototype.pause=function(){return this._playState===t.PAUSED?this:(this._playState=t.PAUSED,q(this),this._pausedAtTime=r(),c.each(this._actors,function(a){a._state.isTweening&&a.pause()}),b(this,"playStateChange",c),b(this,"pause",c),this)},u.prototype.stop=function(){return this._playState=t.STOPPED,q(this),c.each(this._actors,function(a){a.stop()}),b(this,"playStateChange",c),b(this,"stop",c),this},u.prototype.isPlaying=function(){return this._playState===t.PLAYING},u.prototype.animationLength=function(){return this._animationLength},u.prototype.lastPositionUpdated=function(){return this._lastUpdatedMillisecond/this._animationLength},u.prototype.actorCount=function(){return c.size(this._actors)},u.prototype.framerate=function(a){return a&&(this.config.fps=a,this._scheduleUpdate=o(this.config.fps),this._cancelUpdate=p(this.config.fps)),this.config.fps},u.prototype.update=function(a){return b(this,"beforeUpdate",c),c.each(this._actors,function(b){b.updateState(a),typeof b.update=="function"&&b.update(b.context(),b.get())}),this._lastUpdatedMillisecond=a,b(this,"afterUpdate",c),this},u.prototype.on=function(a,b){if(!this._events[a])return;return this._events[a].push(b),this},u.prototype.off=function(a,b){if(!this._events[a])return;return b?this._events[a]=c.without(this._events[a],b):this._events[a]=[],this},u.prototype.exportTimeline=function(){var a={duration:this._animationLength,actors:{}};return c.each(this._actors,function(b){a.actors[b.id]=b.exportTimeline()},this),a},u.util={},c.extend(u.util,{calculateLoopPosition:k,calculateTimeSinceStart:h}),typeof KAPI_DEBUG!="undefined"&&KAPI_DEBUG===!0&&(u._private={calculateLoopPosition:k,updateToCurrentMillisecond:m,tick:n,determineCurrentLoopIteration:g,calculateTimeSinceStart:h,isAnimationComplete:i,updatePlayState:j}),a.Kapi=u},e=function(a,b,d){function g(a){return a.sort(function(a,b){return a-b})}function h(a,b){var c=a._timelinePropertyCacheIndex,d=c.length,e;for(e=1;e<d;e++)if(c[e]>=b)return e-1;return-1}function i(a){b.each(a._propertyTracks,function(c,d){a._propertyTracks[d]=b.sortBy(a._propertyTracks[d],function(a){return a.millisecond})})}function j(a){b.each(a._timelinePropertyCaches,function(c,d){var e=k(a,+d);b.defaults(c,e)})}function k(a,c){var d={};return b.each(a._propertyTracks,function(a,e){var f=null;b.find(a,function(a){return a.millisecond>c?d[e]=f:a.millisecond===c&&(d[e]=a),f=a,!!d[e]});if(!d[e]){var g=b.last(a);g&&g.millisecond<=c&&(d[e]=g)}}),d}function l(a){b.each(a._propertyTracks,function(a,c){b.each(a,function(b,c){b.linkToNext(a[c+1])})})}function m(a,c,d){return b.find(a._propertyTracks[c],function(a){return a.millisecond===d})}function n(a){a._timelinePropertyCaches={},b.each(a._keyframeProperties,function(b){a._timelinePropertyCaches[b.millisecond]||(a._timelinePropertyCaches[b.millisecond]={}),a._timelinePropertyCaches[b.millisecond][b.name]=b},a),a._timelinePropertyCacheIndex=b.keys(a._timelinePropertyCaches),b.each(a._timelinePropertyCacheIndex,function(b,c){a._timelinePropertyCacheIndex[c]=+b},a),g(a._timelinePropertyCacheIndex),j(a),l(a)}"use strict";var e="linear",f=a.Kapi,o=f.Actor=function(a){return a=a||{},d.call(this),b.extend(this,{_data:{},_propertyTracks:{},_timelinePropertyCaches:{},_timelinePropertyCacheIndex:[],_keyframeProperties:{},id:b.uniqueId(),setup:a.setup||c,update:a.update||c,teardown:a.teardown||c}),a.context&&this.context(a.context),this},p=function(){};p.prototype=d.prototype,o.prototype=new p,o.prototype.context=function(a){return a&&(this._context=a),this._context},o.prototype.keyframe=function(c,d,g){var h;return g=g||e,typeof g=="string"&&(h=g,g={},b.each(d,function(a,b){g[b]=h})),b.each(d,function(a,b){g[b]=g[b]||e}),b.each(d,function(a,b){var d=new f.KeyframeProperty(this,c,b,a,g[b]);this._keyframeProperties[d.id]=d,this._propertyTracks[b]||(this._propertyTracks[b]=[]),this._propertyTracks[b].push(d),i(this)},this),this.kapi&&this.kapi._recalculateAnimationLength(),n(this),this},o.prototype.getKeyframeProperty=function(a,b){if(this._propertyTracks[a]&&this._propertyTracks[a][b])return this._propertyTracks[a][b]},o.prototype.modifyKeyframeProperty=function(a,b,c){return this._propertyTracks[a]&&this._propertyTracks[a][b]&&this._propertyTracks[a][b].modifyWith(c),i(this),n(this),this},o.prototype.getTrackNames=function(){return b.keys(this._propertyTracks)},o.prototype.getTrackLength=function(a){if(!this._propertyTracks[a])return;return this._propertyTracks[a].length},o.prototype.copyProperties=function(a,c){var d={},e={};return b.each(this._propertyTracks,function(a,b){var f=m(this,b,c);f&&(d[b]=f.value,e[b]=f.easing)},this),this.keyframe(a,d,e),this},o.prototype.wait=function(a){var c=this.getEnd();if(a<=c)return this;var d=this.getEnd(),e=k(this,this.getEnd()),f={},g={};return b.each(e,function(a,b){f[b]=a.value,g[b]=a.easing}),this.removeKeyframe(d),this.keyframe(d,f,g),this.keyframe(a,f,g),this},o.prototype.getStart=function(){var a=[];return b.each(this._propertyTracks,function(b){b.length&&a.push(b[0].millisecond)}),a.length===0&&(a=[0]),Math.min.apply(Math,a)},o.prototype.getEnd=function(){var a=0;return b.each(this._propertyTracks,function(c){if(c.length){var d=b.last(c).millisecond;d>a&&(a=d)}},this),a},o.prototype.getLength=function(){return this.getEnd()-this.getStart()},o.prototype.hasKeyframeAt=function(a,c){var d=this._propertyTracks;if(c){if(!b.has(d,c))return!1;d=b.pick(d,c)}return b.find(d,function(b,c){return m(this,c,a)!==undefined},this)!==undefined},o.prototype.modifyKeyframe=function(a,c,d){return d=d||{},b.each(this._propertyTracks,function(b,e){var f=m(this,e,a);f&&f.modifyWith({value:c[e],easing:d[e]})},this),this},o.prototype.removeKeyframe=function(a){return b.each(this._propertyTracks,function(c,d){var e=-1,f=!1;b.find(c,function(b){return e++,f=a===b.millisecond,f});if(f){var g=c.splice(e,1)[0];g&&delete this._keyframeProperties[g.id]}},this),this.kapi&&this.kapi._recalculateAnimationLength(),n(this),this},o.prototype.removeAllKeyframeProperties=function(){return b.each(this._propertyTracks,function(a,b){a.length=0},this),this._keyframeProperties={},this.removeKeyframe(0)},o.prototype.updateState=function(a){var c=this.getStart(),d=this.getEnd();if(c<=a&&a<=d){var e=h(this,a),f=this._timelinePropertyCaches[this._timelinePropertyCacheIndex[e]],g={};b.each(f,function(b,c){b&&(g[c]=b.getValueAt(a))}),this.set(g)}return this},o.prototype.data=function(a){return a&&(this._data=a),this._data},o.prototype.exportTimeline=function(){var a={start:this.getStart(),end:this.getEnd(),trackNames:this.getTrackNames(),propertyTracks:{}};return b.each(this._propertyTracks,function(c,d){var e=a.propertyTracks[d]=[];b.each(c,function(a){e.push(a.exportPropertyData())})}),a}},f=function(a,b,c){"use strict";var d="linear",e=a.Kapi,f=e.KeyframeProperty=function(a,c,e,f,g){return this.id=b.uniqueId("keyframeProperty_"),this.ownerActor=a,this.millisecond=c,this.name=e,this.value=f,this.easing=g||d,this.nextProperty=null,this};f.prototype.modifyWith=function(a){var c={};b.each(["millisecond","easing","value"],function(b){c[b]=typeof a[b]=="undefined"?this[b]:a[b]},this),b.extend(this,c)},f.prototype.linkToNext=function(a){this.nextProperty=a||null},f.prototype.getValueAt=function(a){var b={},d={},e;if(this.nextProperty){b[this.name]=this.value,d[this.name]=this.nextProperty.value;var f=this.nextProperty.millisecond-this.millisecond,g=(a-this.millisecond)/f;e=c.util.interpolate(b,d,g,this.nextProperty.easing)[this.name]}else e=this.value;return e},f.prototype.exportPropertyData=function(){return{id:this.id,millisecond:this.millisecond,name:this.name,value:this.value,easing:this.easing}}},g=function(a,c){function e(a,b,c){return typeof c!="undefined"&&(a[b]=c,a.style[b]=c+"px"),a[b]}function f(a){a.config.clearOnUpdate&&a.canvasClear()}function g(a){b(a,"beforeDraw",c);var d=a._drawOrder.length,e;if(a._drawOrderSorter){var f=c.sortBy(a._canvasActors,a._drawOrderSorter);e=c.pluck(f,"id")}else e=a._drawOrder;var g,h,i;for(i=0;i<d;i++)g=a._canvasActors[e[i]],h=g.context(),g.draw(h,g.get());return b(a,"afterDraw",c),a}function h(a,b){b instanceof d.CanvasActor&&(a._drawOrder.push(b.id),a._canvasActors[b.id]=b)}function i(a,b){b instanceof d.CanvasActor&&(a._drawOrder=c.without(a._drawOrder,b.id),delete a._canvasActors[b.id])}"use strict";var d=a.Kapi;d.prototype._contextInitHook.canvas=function(){this._drawOrder=[],this._drawOrderSorter=null,this._canvasActors={},this.config.clearOnUpdate=!0,c.extend(this._events,{beforeDraw:[],afterDraw:[]}),c.each(["Height","Width"],function(a){var b=a.toLowerCase();this.config[b]&&(this["canvas"+a](this.config[b]),delete this.config[a])},this),this.on("afterUpdate",g),this.on("addActor",h),this.on("removeActor",i),this.on("beforeDraw",f)},d.prototype.canvasHeight=function(a){return e(this.context,"height",a)},d.prototype.canvasWidth=function(a){return e(this.context,"width",a)},d.prototype.canvasClear=function(){return this.context.getContext&&this.canvasContext().clearRect(0,0,this.canvasWidth(),this.canvasHeight()),this},d.prototype.canvasContext=function(){return this.context.getContext("2d")},d.prototype.redraw=function(){return g(this),this},d.prototype.moveActorToLayer=function(a,b){if(b<this._drawOrder.length)return this._drawOrder=c.without(this._drawOrder,a.id),this._drawOrder.splice(b,0,a.id),a;return},d.prototype.setOrderFunction=function(a){return this._drawOrderSorter=a,this},d.prototype.unsetOrderFunction=function(){return this._drawOrderSorter=null,this},d.prototype.exportTimeline=function(){var a={duration:this._animationLength,actorOrder:this._drawOrder.slice(0),actors:{}};return c.each(this._drawOrder,function(b){a.actors[b]=this._actors[b].exportTimeline()},this),a}},h=function(a,b){function e(){}"use strict";var d=a.Kapi;e.prototype=d.Actor.prototype;var f=d.CanvasActor=function(a){return d.Actor.call(this,a),a=a||{},this.draw=a.draw||c,this};f.prototype=new e,f.prototype.context=function(a){return a&&(this._context=a),this._context&&this._context.getContext("2d")},f.prototype.moveToLayer=function(a){return this.kapi.moveActorToLayer(this,a)}},i=function(a,b){function e(a,b,c){a.style[b]=c}function f(){}"use strict";var c=a.Kapi,d=["transform","webkitTransform","MozTransform","oTransform","msTransform"];c.DOMActor=function(a){c.Actor.call(this),this._context=a;var b=this.getCSSName();return this._context.className.match(b)||(this._context.className+=" "+b),delete this.update,delete this.teardown,this},f.prototype=c.Actor.prototype,c.DOMActor.prototype=new f,f.prototype.update=function(a,c){b.each(c,function(c,f){f==="transform"?b.each(d,function(b){e(a,b,c)},this):e(a,f,c)},this)},f.prototype.teardown=function(a,c){var d=this._context.className.match(/\S+/g),e=b.without(d,this.getCSSName());this._context.className=e},f.prototype.getCSSName=function(){return"actor-"+this.id}},j=function(a,b){function i(a){return/rgb/.test(a)}function j(a){var c=["{"],d;return b.each(a.get(),function(a,b){d=a;var f=b;b==="transform"&&(f=e),c.push(f+":"+d+";")}),c.push("}"),c.join("")}function k(a,b){var c=a.getLength(),d=a.getStart(),e=[],f,g,h,i=c/b,k=Math.floor(i),l=c/100,m=d+i,n=c+d-i;a.updateState(d),e.push("  from "+j(a));var o;for(o=m;o<=n;o+=i)a.updateState(o),f=(o-d)/l,g=+f.toFixed(2),h=g+"% ",e.push("  "+h+j(a));return a.updateState(c+d),e.push("  to "+j(a)),e.join("\n")}function l(a,c,d){d=d||["w3"];var e=[];return b.each(d,function(b){var d=p(g,[f[b],c,a]),h=m(d,b);e.push(h)}),e.join("\n")}function m(a,b){var c=new RegExp(e,"g"),d=f[b]+"transform",g=a.replace(c,d);return g}function n(a,c,d){c=c||["w3"];var e=[],f;b.each(c,function(b){f=o(a,b,d),e.push(f)});var g=p(h,[d,e.join("\n")]);return g}function o(a,b,c){var d=[],e=f[b],g=a.getStart(),h=a.getEnd()-g;h=p("  %sanimation-duration: %sms;",[e,h]),d.push(h);var i=p("  %sanimation-name: %s;",[e,c+"-keyframes"]);d.push(i);var j=p("  %sanimation-delay: %sms;",[e,g]);d.push(j);var k=p("  %sanimation-fill-mode: forwards;",[e]);return d.push(k),d.join("\n")}"use strict";var c=a.Kapi,d=100,e="TRANSFORM",f=c.util.VENDOR_PREFIXES={microsoft:"-ms-",mozilla:"-moz-",opera:"-o-",w3:"",webkit:"-webkit-"},g=["@%skeyframes %s-keyframes {","%s","}"].join("\n"),h=[".%s {","  position: absolute;","%s","}"].join("\n");a.Kapi.prototype.toCSS=function(a){a=a||{};var c=[],d=this.getActorIds();return b.each(d,function(b){c.push(this.getActor(b).toCSS(a))},this),c.join("\n")},a.Kapi.Actor.prototype.toCSS=function(a){a=a||{};var b=[],c=a.name||this.getCSSName(),e=a.granularity||d,f=n(this,a.vendors,c);b.push(f);var g=k(this,e),h=l(g,c,a.vendors);return b.push(h),b.join("\n")};var p=c.util.printf=function(a,c){var d=a;return b.each(c,function(a){d=d.replace("%s",a)}),d}},k=function(a,b){"use strict";var c=b?{}:a,k=b&&b.underscore?b.underscore:c._,l=b&&b.Tweenable?b.Tweenable:c.Tweenable;return d(c,k,l),e(c,k,l),f(c,k,l),typeof i=="function"&&i(c,k,l),typeof j=="function"&&j(c,k,l),typeof g=="function"&&g(c,k,l),typeof h=="function"&&h(c,k,l),c.Kapi};if(typeof define=="function"&&define.amd){var l=typeof _!="undefined";define(["shifty","underscore"],function(b,c){var d=c!==null,e={Tweenable:b,underscore:d?c:_},f=k(a,e);return typeof KAPI_DEBUG!="undefined"&&KAPI_DEBUG===!0&&(f.underscore_version=e.underscore.VERSION),!l&&d&&(a._=undefined),f})}else k(typeof a!="undefined"?a:this)})(this)